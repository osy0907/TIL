## 1. 도메인 모델 시작!

### 도메인

- `도메인` : 소프트웨어로 해결하고자 하는 문제 영역
- 하나의 도메인은 다시 하위 도메인으로 나눌 수 있다.
    - ex) '온라인 서점' 도메인은 주문, 회원, 혜택, 카탈로그, 리뷰, 정산, 결제, 배송 등의 하위 도메인으로 나눌 수 있다.
    - 하위 도메인들이 엮여서 완전한 기능을 제공

### 도메인 모델

- `도메인모델` : 특정 도메인을 개념적으로 표현한 것.
  - 객체 기반 도메인 모델 : 기능과 데이터 표현 가능
  - 상태 다이어그램을 이용한 상태 모델
  - ex) 주문 도메인 : 상품 선택 -> 계산 -> 계산을 위한 결제수단 -> 주문 -> 배송지 주소 변경. 이러한 일련의 프로세스를 성격에 맞게 표현

도메인 모델을 사용하면 여러 이해관계자들이 동일한 모습으로 도메인을 이해하고 도메인 지식을 공유하는데 도움이 된다.  
도메인 모델은 기본적으로 도메인 자체를 이해하기 위한 개념 모델이다.
개념 모델을 이용해서 바로 코드를 작성할 수 있는 것은 아니기에 구현 기술에 맞는 구현 모델이 따로 필요하다. 개념 모델과 구현 모델은 서로 다른 것이지만 구현 모델이 개념 모델을 최대한 따르도록 할 수는 있다.
 - ex) 객체 기반 모델 -> 객체 지향 언어를 이용해 개념 모델 가깝게 구현
 - ex) 수학적 모델 -> 함수를 이용해 도메인 모델과 유사한 구현 모델 구현

#### 모델, 모델링?
- 일반적으로, 모두에게 공통적으로 이해되도록 약속된 방식(수식,그림 등)으로 표현하는 것
  - 복잡한 현실세계를 단순화(추상화) 즉, `추상적 체계적으로 표현하는 작업 또는 방법`
    - 통상, 관련자들끼리 상호이해를 쉽게 하도록 다이어그램화 함

- 공학적으로는, 시스템(체계)적인 특성을 `수학적으로 표현하는 과정(수식화)`
  - 정량적으로 표현되도록 수학적 언어로 전환시키는 과정
    - 좋은 모델링 이란?   컴퓨터를 이용하여 해석,시뮬레이션,설계하기 쉬운 모델

### 도메인 모델 패턴

| 계층             | 설명                                                                                       |
| -----------     | --------------------------------------------------------------------------------          |
| 사용자인터페이스 UI | 사용자의 요청을 처리하고 사용자에게 정보를 보여준다. 여기서 사용자는 소프트웨어를 사용하는 사람뿐만 아니라 외부 시스템도 사용자가 돌 수 있다. |
| 응용             | 사용자가 요청한 기능을 실행한다. 업무 로직을 직접 구현핮 않으며 도메인 계층을 조합해서 기능을 실행한다.         |
| 도메인           | 시스템이 제공할 도메인의 규칙을 구현한다.                                                          |
| 인프라스트럭처     | 데이터베이스나 메시징 시스템과 같은 외부 시스템과 연동을 처리한다.                                       |

- `도메인 모델` : 아키텍처상의 도메인 계층을 객체 지향 기법으로 구현하는 패턴을 말함.
  - 도메인 계층은 도메인의 핵심 규칙을 구현한다.
  
핵심 규칙을 구현한 코드는 도메인 모델에만 위치하기 때문에 규칙이 바뀌거나 규칙을 확장해야 할 때 다른 코드에 영향을 덜 주고 변경 내역을 모델에 반영할 수 있게 된다.

### 도메인 모델 도출

도메인을 모델링할 때 기본이 되는 작업은 모델을 구성하는 핵심 구성요소, 규칙, 기능을 찾는 것.

### 엔티티와 밸류
도출한 모델은 크게 엔티티(Entity)와 밸류(Value)로 구분할 수 있다.
- 엔티티
  - 가장 큰 특징은 `식별자` 를 갖는다는 것이다.
    - 엔티티의 식별자는 바뀌지 않고 고유하기 때문에 두 엔티티 객체의 식별자가 같으면 두 엔티티는 같다고 판단할 수 있다. (eq & hc 구현 시 식별자만 비교하도록 구현할 수 있다.)
    - 엔티티의 식별자를 생성하는 시점은 도메인의 특징과 사용하는 기술에 따라 달라진다.  
    - 식별자는 다음 중 한 가지 방식으로 생성한다.
      - 특정 규칙에 따라 생성
      - UUID 사용
      - 값을 직접 입력
      - 일련번호 사용(시퀀스나 DB auto_increment 칼럼 사용)
- 밸류
  - 개념적으로 완전한 하나를 표현할 때 사용한다.
  - 밸류 객체의 데이터를 변경할 때는 기존 데이터를 변경하기보다는 변경한 데이터를 갖는 새로운 밸류 객체를 생성하는 방식을 선호한다. `불변`
    - 불변으로 구현하는 이유는 여러 가지가 있는데 가장 중요한 이유는 불변 타입을 사용하면 보다 안전한 코드를 작성할 수 있다는 것. 
    - 불변 객체는 참조 투명성과 스레드 안전한 특징을 갖고 있다.
  - 두 밸류 객체가 같은지 비교할 때는 모든 속성을 비교해야 한다.
    도메인 객체가 불완전한 상태로 사용되는 것을 막으려면 setter를 열어두지 말고, 생성 시점에 생성자를 통해 필요한 것을 전달해 주어야 한다.  
    생성자에서는 전달받은 데이터의 유효성을 생성 시점에 검사할 수 있다.

### 도메인 용어

도메인에서 사용하는 용어를 코드에 반영하지 않으면 그 코드는 개발자에게 코드의 의미를 해석해야 하는 부담을 준다.  

## 2. 아키텍처 개요

### 네 개의 영역

아키텍처를 설계할 때 출현하는 전형적인 영역이 `표현`, `응용`, `도메인`, `인프라스트럭`처의 네 영역이다.

- 표현
  - 사용자의 요청을 받아 응용 영역에 전달하고 응용 영역의 처리 결과를 다시 사용자에게 보여주는 역할
  - Spring MVC
  - 사용자는 사람일 수도 있고, 외부 시스템일 수도 있다.
- 응용
  - 시스템이 사용자에게 제공해야 할 기능을 구현
  - 기능을 구현하기 위해 도메인 영역의 도메인 모델을 사용
  - 로직을 직접 수행하기 보다는 도메인 모델에 로직 수행을 위임
- 도메인
  - 도메인 모델을 구현
  - 도메인 모델은 도메인의 핵심 로직을 구현
- 인프라스트럭처
  - 논리적인 개념 보다는 실제 구현 기술에 대한 것들
  - 도메인, 응용, 표현 영역은 구현 기술을 사용한 코드를 직접 만들지 않고, 인프라스트럭처 영역에서 제공하는 기능들을 사용해서 필요한 기능을 개발한다.

### 계층 구조 아키텍처

계층 구조는 그 특성상 상위 계층에서 하위 계층으로의 의존만 존재하고 하위 계층은 상위 계층에 의존하지 않는다.
예를 들어, 표현은 응용에, 응용은 도메인에 의존하고, 반대로 인프라스트럭처 계층이 도메인에 의존하거나 하지는 않는다.

하지만, 짚고 넘어가야 할 것이 있는데 바로 표현, 응용, 도메인 계층이 상세한 구현 기술을 다루는 인프라스트럭처 계층에 종속된다는 점이다.
이는 두 가지 문제를 안고 있는데, 테스트가 어렵다 는 것과 기능 확장이 어렵다 는 것이다.
상위 계층에서 구체적인 구현 기술에 대한 의존을 하고 있으니 실제 테스트가 어려워지고, 구현 기술에 의존적인 만큼 그에 맞추어진 타입, 객체들을 fit하게 만들게 되어 기능 확장을 어렵게 한다.

이를 해결하기 위해서는 DIP를 사용해야 한다.


  
  
